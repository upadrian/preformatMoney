//URL: https://github.com/upadrian/preformatMoney/
(function(e,t,n,r){"use strict";function o(t,n){this.element=t;this.options=e.extend({},s,n);this.$el=e(t);this.init()}var i="preformat";var s={symbol:"$",precision:2,thousand:",",decimal:".",format:"%s%v"};o.prototype={init:function(){if(this.preChecksFail())return false;var t='<input readonly="readonly" type="text" name="pre-'+this.$el.attr("name")+'" id="pre-'+this.$el.attr("id")+'" value="" />';this.$el.data("display",this.$el.css("display")).after(t).css("display","none");this.$target=e("#pre-"+this.$el.attr("id"));this.$target.css("display",this.$el.data("display")).css("cursor","pointer").attr("class",this.$el.attr("class"));this.getValue();this.setPreValue(this);this.setEvents(this)},preChecksFail:function(){if(!this.$el.attr("id")){try{console.log("Preformat plugin: missed id attribute on...");console.debug(this.$el)}catch(e){}return true}if(!this.$el.attr("name")){try{console.log("Preformat plugin: missed name attribute on...");console.debug(this.$el)}catch(e){}return true}if(this.$el.attr("type")!="text"&&this.$el.attr("type")!="number"){try{console.log("Preformat plugin: type "+this.$el.attr("type")+" not supported on...");console.debug(this.$el)}catch(e){}return true}if(typeof accounting!="object"){try{console.log("We need accounting plugin, get it on http://josscrowcroft.github.com/accounting.js")}catch(e){}return true}},getValue:function(){this.valorOriginal=this.$el.val();if(!this.isNumber(this.valorOriginal)){this.valorOriginal=0;this.$el.val(0)}},setEvents:function(t){t.$target.focus(function(){e(this).css("display","none");t.$el.css("display",t.$el.data("display")).focus()});t.$el.blur(function(){e(this).css("display","none");t.$target.css("display",t.$el.data("display"))}).change(function(){t.getValue();t.setPreValue()}).keydown(function(e){if(e.keyCode<96||e.keyCode>105){if(e.keyCode!=8&&e.keyCode!=37&&e.keyCode!=38&&e.keyCode!=39&&e.keyCode!=40&&e.keyCode!=13&&e.keyCode!=9&&e.keyCode!=46&&e.keyCode!=16&&e.keyCode!=17&&e.keyCode!=35&&e.keyCode!=36)return false}})},isNumber:function(e){return!isNaN(+e)&&isFinite(e)},setPreValue:function(){this.valor=accounting.formatMoney(this.valorOriginal,this.options.symbol,this.options.precision,this.options.thousand,this.options.decimal,this.options.format);this.$target.val(this.valor)},destroy:function(){this.$el.css("display",this.$el.data("display")).unbind("blur").unbind("change").unbind("keydown").data("plugin_"+i,false);this.$target.remove();this.$target=null}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i))e.data(this,"plugin_"+i,new o(this,t));else{var n=e.data(this,"plugin_"+i);if(typeof n[t]==="function")return n[t]()}})}})(jQuery,document,window)