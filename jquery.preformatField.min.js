//URL: https://github.com/upadrian/preformatMoney/
;(function($,document,window,undefined){"use strict";var pluginName='preformat';var defaults={symbol:"$",precision:2,thousand:",",decimal:".",format:"%s%v"};function Plugin(element,options){this.element=element;this.options=$.extend({},defaults,options);this.$el=$(element);this.$el.data(name,this);this._defaults=defaults;var meta=this.$el.data(name+'-opts');this.options=$.extend(this._defaults,options,meta);this.init();}Plugin.prototype={init:function(){if(this.preChecksFail())return false;var html='<input readonly="readonly" type="text" name="pre-'+this.$el.attr("name")+'" id="pre-'+this.$el.attr("id")+'" value="" />';this.$el.data("display",this.$el.css("display")).after(html).css("display","none");this.$target=$("#pre-"+this.$el.attr("id"));this.$target.css("display",this.$el.data("display")).css("cursor","pointer").attr("class",this.$el.attr("class"));this.getValue();this.setPreValue(this);this.setEvents(this);},preChecksFail:function(){if(!this.$el.attr("id")){try{console.log("Preformat plugin: missed id attribute on...");console.debug(this.$el);}catch(e){}return true;}if(!this.$el.attr("name")){try{console.log("Preformat plugin: missed name attribute on...");console.debug(this.$el);}catch(e){}return true;}if(this.$el.attr("type")!="text"&&this.$el.attr("type")!="number"){try{console.log("Preformat plugin: type "+this.$el.attr("type")+" not supported on...");console.debug(this.$el);}catch(e){}return true;}if(typeof(accounting)!="object"){try{console.log("We need accounting plugin, get it on http://josscrowcroft.github.com/accounting.js");}catch(e){}return true;}},getValue:function(){this.valorOriginal=this.$el.val();if(!this.isNumber(this.valorOriginal)){this.valorOriginal=0;this.$el.val(0);}},setEvents:function(plugin){plugin.$target.focus(function(){$(this).css("display","none");plugin.$el.css("display",plugin.$el.data("display")).focus();});plugin.$el.blur(function(){$(this).css("display","none");plugin.$target.css("display",plugin.$el.data("display"));}).change(function(){plugin.getValue();plugin.setPreValue();}).keydown(function(event){if(event.keyCode<96||event.keyCode>105){if(event.keyCode!=8&&event.keyCode!=37&&event.keyCode!=38&&event.keyCode!=39&&event.keyCode!=40&&event.keyCode!=13&&event.keyCode!=9)return false;}})},isNumber:function(n){return!isNaN(+n)&&isFinite(n);},setPreValue:function(){this.valor=accounting.formatMoney(this.valorOriginal,this.options.symbol,this.options.precision,this.options.thousand,this.options.decimal,this.options.format);this.$target.val(this.valor);}};$.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,'plugin_'+pluginName))$.data(this,'plugin_'+pluginName,new Plugin(this,options));});};})(jQuery,document,window);